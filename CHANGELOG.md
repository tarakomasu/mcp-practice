# 変更履歴

## [1.2.0] - 2025-11-11

### リファクタリング

- **コード構造の大幅改善**
  - モジュール分割: 責務ごとにファイルを分離
    - `route.ts`: HTTPエンドポイントハンドラー（通信層）
    - `lib/helpers.ts`: ヘルパー関数（変換・CORS）
    - `lib/mcp-server.ts`: MCPサーバーセットアップ
    - `tools/countJapaneseChars.ts`: ツール実装

- **超詳細コメントの追加**
  - すべてのファイルに包括的なドキュメンテーション
  - なぜ・どのように・注意点を明記
  - 具体的な使用例を追加
  - 初心者でも理解できるレベルの説明

- **保守性の向上**
  - 関心の分離（Separation of Concerns）
  - 単一責任の原則（Single Responsibility Principle）
  - 再利用可能なモジュール設計
  - テスト容易性の向上

### ドキュメント

- README.mdにコード構造セクションを追加
- 各モジュールの役割を明確化

## [1.1.0] - 2025-11-11

### 追加

- **ランタイム指定** (`runtime = "nodejs"`, `dynamic = "force-dynamic"`)
  - Vercel/Next.jsのサーバレス環境でNode.js APIを確実に使用
  - Edge Runtimeでの予期せぬエラーを防止

- **Intl.Segmenterフォールバック機能**
  - 非対応環境でも動作するようにフォールバック実装
  - 警告ログを出力して問題を早期発見

- **Authorizationヘッダー対応**
  - CORSで`Authorization`ヘッダーを許可
  - 将来のBearer認証実装に対応

### 改善

- **初期化ロジックの強化**
  - `isInitializeRequest`を検出したら無条件で新規セッションを作成
  - クライアント実装の違いに柔軟に対応
  - 既存セッションがあれば自動的に置き換え

- **ツールレスポンスの互換性向上**
  - contentに複数の形式（テキスト + JSON）を含める
  - 様々なMCPクライアントとの互換性を確保

- **GETエンドポイントの簡素化**
  - SSE不要のためヘルスチェック専用に変更
  - セッション状態の確認が可能に

- **DELETEエンドポイントの最適化**
  - 不要な`handleRequest`呼び出しを削除
  - シンプルなセッション削除に変更
  - より明確なレスポンスメッセージ

### エラーハンドリング

- すべてのエラーレスポンスにJSON-RPC形式のidを含める
- より詳細なエラーメッセージを提供
- ログ出力の改善

## [1.0.0] - 2025-11-11

### 初回リリース

- 日本語文字数カウントMCPサーバーの実装
- `countJapaneseChars`ツールの提供
- Next.js 16 + App Router対応
- Web版ChatGPT「新しいコネクター」対応
- Vercelへの簡単デプロイ
- 包括的なドキュメント

